<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MeterLabToolkit.ViewModels.ReferenceTables"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="MeterLabToolkit.Views.ReferenceTables.DeviceCodeTableView"
             x:DataType="vm:DeviceCodeTableViewModel">
    
    <Design.DataContext>
        <vm:DeviceCodeTableViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="20,20,20,10">
            <TextBlock Text="Device Codes" FontSize="24" FontWeight="Bold" Foreground="#1a1a1a"/>
            <TextBlock Text="Manage device code reference data" Foreground="#333333" Opacity="0.7" Margin="0,5,0,0"/>
            <TextBlock Text="{Binding ErrorMessage}" 
                       Foreground="#D13438"
                       IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                       Margin="0,10,0,0"/>
        </StackPanel>

        <!-- Record Count -->
        <TextBlock Grid.Row="0" Text="{Binding Items.Count, StringFormat='Total records: {0}'}" 
                   Foreground="#666666"
                   Margin="20,0,20,10"
                   VerticalAlignment="Bottom"
                   FontSize="12"/>

        <!-- DataGrid -->
        <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="4" Margin="20,0,20,10">
            <DataGrid ItemsSource="{Binding Items}"
                      SelectedItem="{Binding SelectedItem}"
                      AutoGenerateColumns="False"
                      GridLinesVisibility="All"
                      IsReadOnly="False"
                      CanUserResizeColumns="True"
                      CanUserSortColumns="True"
                      Background="White"
                      RowBackground="White"
                      HeadersVisibility="Column"
                      BorderThickness="0">
                <DataGrid.Styles>
                    <!-- Column Header Styling -->
                    <Style Selector="DataGridColumnHeader">
                        <Setter Property="Background" Value="#E8E8E8"/>
                        <Setter Property="Foreground" Value="#1a1a1a"/>
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="BorderBrush" Value="#D0D0D0"/>
                        <Setter Property="BorderThickness" Value="0,0,1,1"/>
                    </Style>
                    
                    <!-- Row Styling -->
                    <Style Selector="DataGridRow">
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="Foreground" Value="#333333"/>
                    </Style>
                    <Style Selector="DataGridRow:nth-child(even)">
                        <Setter Property="Background" Value="#F5F5F5"/>
                    </Style>
                    <Style Selector="DataGridRow:selected">
                        <Setter Property="Background" Value="#0078D4"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Style>
                    <Style Selector="DataGridRow:pointerover:not(:selected)">
                        <Setter Property="Background" Value="#E5F3FF"/>
                    </Style>
                    
                    <!-- Cell Styling -->
                    <Style Selector="DataGridCell">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="#333333"/>
                        <Setter Property="Padding" Value="10,6"/>
                        <Setter Property="BorderBrush" Value="#E0E0E0"/>
                        <Setter Property="BorderThickness" Value="0,0,1,0"/>
                    </Style>
                    <Style Selector="DataGridCell:selected">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Foreground" Value="White"/>
                    </Style>
                    
                    <!-- TextBox in cells when editing -->
                    <Style Selector="DataGridCell TextBox">
                        <Setter Property="Foreground" Value="#333333"/>
                        <Setter Property="Background" Value="White"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                    </Style>
                    
                    <!-- TextBlock in cells for display -->
                    <Style Selector="DataGridCell TextBlock">
                        <Setter Property="Foreground" Value="#333333"/>
                        <Setter Property="VerticalAlignment" Value="Center"/>
                    </Style>
                </DataGrid.Styles>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Code" Binding="{Binding Code}" Width="150"/>
                    <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                    <DataGridTextColumn Header="Device Type" Binding="{Binding DeviceType}" Width="150"/>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Action Buttons -->
        <Border Grid.Row="2" Background="#F5F5F5" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Padding="20,10">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Content="Add New" Command="{Binding AddNewCommand}" 
                        Background="#0078D4" Foreground="White" Padding="15,8"/>
                <Button Content="Save" Command="{Binding SaveCommand}"
                        Background="#107C10" Foreground="White" Padding="15,8"/>
                <Button Content="Delete Selected" Command="{Binding DeleteCommand}"
                        Background="#D13438" Foreground="White" Padding="15,8"/>
                <Separator Width="1" Background="#E0E0E0" Margin="10,0"/>
                <Button Content="Import CSV" Command="{Binding ImportCsvCommand}"
                        Background="#5C2D91" Foreground="White" Padding="15,8"/>
                <Button Content="Export CSV" Command="{Binding ExportCsvCommand}"
                        Background="#666666" Foreground="White" Padding="15,8"/>
                
                <!-- Loading indicator -->
                <TextBlock Text="Loading..." 
                          IsVisible="{Binding IsLoading}"
                          VerticalAlignment="Center"
                          Margin="20,0,0,0"
                          Foreground="#333333"
                          Opacity="0.7"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
