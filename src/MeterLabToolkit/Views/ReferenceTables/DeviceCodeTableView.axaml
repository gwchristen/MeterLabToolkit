<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MeterLabToolkit.ViewModels.ReferenceTables"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="MeterLabToolkit.Views.ReferenceTables.DeviceCodeTableView"
             x:DataType="vm:DeviceCodeTableViewModel">
     
    <Design.DataContext>
        <vm:DeviceCodeTableViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,Auto,*,Auto" Margin="20">
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Device Codes" FontSize="24" FontWeight="Bold" Foreground="#ffffff"/>
            <TextBlock Text="Manage device code reference data" Foreground="#999999" Margin="0,5,0,0"/>
        </StackPanel>
        
        <!-- Status/Error Message and Record Count -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <TextBlock Text="{Binding ErrorMessage}" 
                       Foreground="#d13438"
                       IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
            <TextBlock Text="{Binding Items.Count, StringFormat='Records: {0}'}"
                       Foreground="#999999"
                       HorizontalAlignment="Right"/>
        </Grid>

        <!-- Table Container -->
        <Border Grid.Row="2" 
                Background="#1e1e1e" 
                BorderBrush="#3f3f46" 
                BorderThickness="1"
                CornerRadius="4"
                Margin="0,0,0,10"
                MinHeight="200">
            <Grid RowDefinitions="Auto,*">
                <!-- Column Headers -->
                <Border Grid.Row="0" Background="#3c3c3c" Padding="0">
                    <Grid ColumnDefinitions="30,150,*,150">
                        <TextBlock Grid.Column="0" Text="" Padding="8"/>
                        <TextBlock Grid.Column="1" Text="Code" FontWeight="Bold" Foreground="#ffffff" Padding="12,8"/>
                        <TextBlock Grid.Column="2" Text="Description" FontWeight="Bold" Foreground="#ffffff" Padding="12,8"/>
                        <TextBlock Grid.Column="3" Text="Device Type" FontWeight="Bold" Foreground="#ffffff" Padding="12,8"/>
                    </Grid>
                </Border>
                
                <!-- Data Rows using ListBox -->
                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Items}"
                         SelectedItems="{Binding SelectedItems}"
                         Background="Transparent"
                         BorderThickness="0"
                         SelectionMode="Multiple">
                    <ListBox.Styles>
                        <Style Selector="ListBoxItem">
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Background" Value="#2d2d30"/>
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                        <Style Selector="ListBoxItem:nth-child(even)">
                            <Setter Property="Background" Value="#252526"/>
                        </Style>
                        <Style Selector="ListBoxItem:selected">
                            <Setter Property="Background" Value="#0078d4"/>
                        </Style>
                        <Style Selector="ListBoxItem:selected TextBox">
                            <Setter Property="Foreground" Value="#ffffff"/>
                        </Style>
                        <Style Selector="ListBoxItem:pointerover">
                            <Setter Property="Background" Value="#3a3a3a"/>
                        </Style>
                    </ListBox.Styles>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="30,150,*,150" Background="Transparent">
                                <!-- Selection indicator / row selector -->
                                <Border Grid.Column="0" 
                                        Background="Transparent"
                                        Cursor="Hand"
                                        ToolTip.Tip="Click to select row">
                                    <TextBlock Text="â˜" 
                                               Foreground="#666666" 
                                               VerticalAlignment="Center" 
                                               HorizontalAlignment="Center"
                                               FontSize="14"/>
                                </Border>
                                
                                <!-- Code column -->
                                <Border Grid.Column="1" BorderBrush="#3f3f46" BorderThickness="0,0,1,1" Padding="8,4">
                                    <TextBox Text="{Binding Code, Mode=TwoWay}" 
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="#e0e0e0"
                                             Padding="4"
                                             VerticalAlignment="Center"/>
                                </Border>
                                
                                <!-- Description column -->
                                <Border Grid.Column="2" BorderBrush="#3f3f46" BorderThickness="0,0,1,1" Padding="8,4">
                                    <TextBox Text="{Binding Description, Mode=TwoWay}" 
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="#e0e0e0"
                                             Padding="4"
                                             VerticalAlignment="Center"/>
                                </Border>
                                
                                <!-- Device Type column -->
                                <Border Grid.Column="3" BorderBrush="#3f3f46" BorderThickness="0,0,0,1" Padding="8,4">
                                    <TextBox Text="{Binding DeviceType, Mode=TwoWay}" 
                                             Background="Transparent"
                                             BorderThickness="0"
                                             Foreground="#e0e0e0"
                                             Padding="4"
                                             VerticalAlignment="Center"/>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </Border>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="10">
            <Button Content="Add New" Command="{Binding AddNewCommand}"/>
            <Button Content="Save" Command="{Binding SaveCommand}" Background="#107c10"/>
            <Button Content="Delete Selected" Command="{Binding DeleteCommand}" Background="#d13438"/>
            <Button Content="Import CSV" Command="{Binding ImportCsvCommand}" Background="#5c2d91"/>
            <Button Content="Export CSV" Command="{Binding ExportCsvCommand}" Background="#505050"/>
            
            <!-- Loading indicator -->
            <TextBlock Text="Loading..." 
                      IsVisible="{Binding IsLoading}"
                      VerticalAlignment="Center"
                      Margin="20,0,0,0"
                      Foreground="#999999"/>
        </StackPanel>
    </Grid>
</UserControl>
