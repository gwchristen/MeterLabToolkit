<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:MeterLabToolkit.ViewModels.DataEntry"
             xmlns:controls="using:Avalonia.Controls"
             mc:Ignorable="d" d:DesignWidth="1200" d:DesignHeight="800"
             x:Class="MeterLabToolkit.Views.DataEntry.CreatedHistoriesView"
             x:DataType="vm:CreatedHistoriesViewModel">
     
    <Design.DataContext>
        <vm:CreatedHistoriesViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto">
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,10">
            <TextBlock Text="Created Histories" FontSize="24" FontWeight="Bold" Foreground="#ffffff"/>
            <TextBlock Text="Manage meter and device creation history records" Foreground="#999999" Margin="0,5,0,0"/>
        </StackPanel>

        <!-- TabControl and Content -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <TabControl SelectedIndex="{Binding SelectedTabIndex}">
                <!-- Ohio - Meters -->
                <TabItem Header="Ohio - Meters">
                    <Grid ColumnDefinitions="2*,3*" Margin="10">
                        <!-- Left: ListBox-based table -->
                        <Border Grid.Column="0" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Margin="0,0,10,0" Background="#2d2d30">
                            <Grid RowDefinitions="Auto,Auto,*">
                                <!-- Record Count -->
                                <TextBlock Grid.Row="0" Text="{Binding Histories.Count, StringFormat='Records: {0}'}"
                                           Foreground="#999999"
                                           HorizontalAlignment="Right"
                                           Margin="0,5,10,5"/>
                                
                                <!-- Column Headers -->
                                <Border Grid.Row="1" Background="#3c3c3c" Padding="8">
                                    <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                        <TextBlock Grid.Column="0" Text="DevCode" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="1" Text="BegSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="2" Text="EndSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="3" Text="OOR" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="4" Text="Qty" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="5" Text="PONumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="6" Text="RecvDate" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="7" Text="CID" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="8" Text="MENumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="9" Text="Established" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Data Rows -->
                                <ListBox Grid.Row="2"
                                         ItemsSource="{Binding Histories}"
                                         SelectedItem="{Binding SelectedHistory}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.Styles>
                                        <Style Selector="ListBoxItem">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Margin" Value="0"/>
                                            <Setter Property="Background" Value="#2d2d30"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:nth-child(even)">
                                            <Setter Property="Background" Value="#252526"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:selected">
                                            <Setter Property="Background" Value="#0078d4"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:pointerover">
                                            <Setter Property="Background" Value="#3a3a3a"/>
                                        </Style>
                                    </ListBox.Styles>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#3f3f46" BorderThickness="0,0,0,1" Padding="8,6">
                                                <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                                    <TextBlock Grid.Column="0" Text="{Binding DevCode}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding BegSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding EndSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="3" Text="{Binding OOR}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="4" Text="{Binding Qty}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="5" Text="{Binding PONumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="6" Text="{Binding RecvDate, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="7" Text="{Binding CID}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="8" Text="{Binding MENumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="9" Text="{Binding Established, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <!-- Right: Form -->
                        <Border Grid.Column="1" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="15" Background="#2d2d30">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="Record Details" FontSize="16" FontWeight="SemiBold" Foreground="#ffffff" Margin="0,0,0,10"/>

                                    <!-- Status Message -->
                                    <TextBlock Text="{Binding StatusMessage}"
                                               Foreground="#d13438"
                                               IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                               Margin="0,0,0,10"
                                               FontWeight="SemiBold"/>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Status" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Statuses}"
                                                 SelectedItem="{Binding SelectedStatus}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Manufacturer" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Manufacturers}"
                                                 SelectedItem="{Binding SelectedManufacturer}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Device Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding DeviceCodes}"
                                                 SelectedItem="{Binding SelectedDevCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Beginning Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding BegSer}" Watermark="Enter beginning serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Ending Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding EndSer}" Watermark="Enter ending serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Out of Range (OOR)" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Oor}" 
                                                Watermark="e.g., 10023-10033, 20023-20033"
                                                AcceptsReturn="False"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Quantity" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Qty}" IsReadOnly="True" Background="#252526"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding PoDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding PoNumber}" Watermark="Enter PO number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Received Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding RecvDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Unit Cost" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding UnitCost}" Watermark="0.00"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="CID" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Cid}" Watermark="Enter CID"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="M.E. Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding MeNumber}" Watermark="Enter M.E. number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Purchase Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding PurchaseCodes}"
                                                 SelectedItem="{Binding SelectedPurCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Established" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding Established}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Notes" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Notes}" 
                                                AcceptsReturn="True" 
                                                TextWrapping="Wrap"
                                                Height="80"
                                                Watermark="Enter notes (optional)"/>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- I&M - Meters -->
                <TabItem Header="I&amp;M - Meters">
                    <Grid ColumnDefinitions="2*,3*" Margin="10">
                        <!-- Left: ListBox-based table -->
                        <Border Grid.Column="0" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Margin="0,0,10,0" Background="#2d2d30">
                            <Grid RowDefinitions="Auto,Auto,*">
                                <!-- Record Count -->
                                <TextBlock Grid.Row="0" Text="{Binding Histories.Count, StringFormat='Records: {0}'}"
                                           Foreground="#999999"
                                           HorizontalAlignment="Right"
                                           Margin="0,5,10,5"/>
                                
                                <!-- Column Headers -->
                                <Border Grid.Row="1" Background="#3c3c3c" Padding="8">
                                    <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                        <TextBlock Grid.Column="0" Text="DevCode" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="1" Text="BegSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="2" Text="EndSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="3" Text="OOR" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="4" Text="Qty" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="5" Text="PONumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="6" Text="RecvDate" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="7" Text="CID" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="8" Text="MENumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="9" Text="Established" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Data Rows -->
                                <ListBox Grid.Row="2"
                                         ItemsSource="{Binding Histories}"
                                         SelectedItem="{Binding SelectedHistory}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.Styles>
                                        <Style Selector="ListBoxItem">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Margin" Value="0"/>
                                            <Setter Property="Background" Value="#2d2d30"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:nth-child(even)">
                                            <Setter Property="Background" Value="#252526"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:selected">
                                            <Setter Property="Background" Value="#0078d4"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:pointerover">
                                            <Setter Property="Background" Value="#3a3a3a"/>
                                        </Style>
                                    </ListBox.Styles>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#3f3f46" BorderThickness="0,0,0,1" Padding="8,6">
                                                <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                                    <TextBlock Grid.Column="0" Text="{Binding DevCode}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding BegSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding EndSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="3" Text="{Binding OOR}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="4" Text="{Binding Qty}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="5" Text="{Binding PONumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="6" Text="{Binding RecvDate, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="7" Text="{Binding CID}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="8" Text="{Binding MENumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="9" Text="{Binding Established, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <Border Grid.Column="1" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="15" Background="#2d2d30">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="Record Details" FontSize="16" FontWeight="SemiBold" Foreground="#ffffff" Margin="0,0,0,10"/>

                                    <!-- Status Message -->
                                    <TextBlock Text="{Binding StatusMessage}"
                                               Foreground="#d13438"
                                               IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                               Margin="0,0,0,10"
                                               FontWeight="SemiBold"/>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Status" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Statuses}"
                                                 SelectedItem="{Binding SelectedStatus}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Manufacturer" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Manufacturers}"
                                                 SelectedItem="{Binding SelectedManufacturer}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Device Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding DeviceCodes}"
                                                 SelectedItem="{Binding SelectedDevCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Beginning Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding BegSer}" Watermark="Enter beginning serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Ending Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding EndSer}" Watermark="Enter ending serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Out of Range (OOR)" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Oor}" 
                                                Watermark="e.g., 10023-10033, 20023-20033"
                                                AcceptsReturn="False"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Quantity" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Qty}" IsReadOnly="True" Background="#252526"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding PoDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding PoNumber}" Watermark="Enter PO number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Received Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding RecvDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Unit Cost" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding UnitCost}" Watermark="0.00"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="CID" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Cid}" Watermark="Enter CID"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="M.E. Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding MeNumber}" Watermark="Enter M.E. number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Purchase Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding PurchaseCodes}"
                                                 SelectedItem="{Binding SelectedPurCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Established" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding Established}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Notes" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Notes}" 
                                                AcceptsReturn="True" 
                                                TextWrapping="Wrap"
                                                Height="80"
                                                Watermark="Enter notes (optional)"/>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- Ohio - Transformers -->
                <TabItem Header="Ohio - Transformers">
                    <Grid ColumnDefinitions="2*,3*" Margin="10">
                        <!-- Left: ListBox-based table -->
                        <Border Grid.Column="0" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Margin="0,0,10,0" Background="#2d2d30">
                            <Grid RowDefinitions="Auto,Auto,*">
                                <!-- Record Count -->
                                <TextBlock Grid.Row="0" Text="{Binding Histories.Count, StringFormat='Records: {0}'}"
                                           Foreground="#999999"
                                           HorizontalAlignment="Right"
                                           Margin="0,5,10,5"/>
                                
                                <!-- Column Headers -->
                                <Border Grid.Row="1" Background="#3c3c3c" Padding="8">
                                    <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                        <TextBlock Grid.Column="0" Text="DevCode" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="1" Text="BegSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="2" Text="EndSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="3" Text="OOR" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="4" Text="Qty" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="5" Text="PONumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="6" Text="RecvDate" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="7" Text="CID" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="8" Text="MENumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="9" Text="Established" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Data Rows -->
                                <ListBox Grid.Row="2"
                                         ItemsSource="{Binding Histories}"
                                         SelectedItem="{Binding SelectedHistory}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.Styles>
                                        <Style Selector="ListBoxItem">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Margin" Value="0"/>
                                            <Setter Property="Background" Value="#2d2d30"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:nth-child(even)">
                                            <Setter Property="Background" Value="#252526"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:selected">
                                            <Setter Property="Background" Value="#0078d4"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:pointerover">
                                            <Setter Property="Background" Value="#3a3a3a"/>
                                        </Style>
                                    </ListBox.Styles>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#3f3f46" BorderThickness="0,0,0,1" Padding="8,6">
                                                <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                                    <TextBlock Grid.Column="0" Text="{Binding DevCode}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding BegSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding EndSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="3" Text="{Binding OOR}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="4" Text="{Binding Qty}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="5" Text="{Binding PONumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="6" Text="{Binding RecvDate, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="7" Text="{Binding CID}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="8" Text="{Binding MENumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="9" Text="{Binding Established, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <Border Grid.Column="1" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="15" Background="#2d2d30">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="Record Details" FontSize="16" FontWeight="SemiBold" Foreground="#ffffff" Margin="0,0,0,10"/>

                                    <!-- Status Message -->
                                    <TextBlock Text="{Binding StatusMessage}"
                                               Foreground="#d13438"
                                               IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                               Margin="0,0,0,10"
                                               FontWeight="SemiBold"/>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Status" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Statuses}"
                                                 SelectedItem="{Binding SelectedStatus}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Manufacturer" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Manufacturers}"
                                                 SelectedItem="{Binding SelectedManufacturer}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Device Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding DeviceCodes}"
                                                 SelectedItem="{Binding SelectedDevCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Beginning Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding BegSer}" Watermark="Enter beginning serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Ending Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding EndSer}" Watermark="Enter ending serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Out of Range (OOR)" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Oor}" 
                                                Watermark="e.g., 10023-10033, 20023-20033"
                                                AcceptsReturn="False"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Quantity" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Qty}" IsReadOnly="True" Background="#252526"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding PoDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding PoNumber}" Watermark="Enter PO number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Received Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding RecvDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Unit Cost" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding UnitCost}" Watermark="0.00"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="CID" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Cid}" Watermark="Enter CID"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="M.E. Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding MeNumber}" Watermark="Enter M.E. number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Purchase Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding PurchaseCodes}"
                                                 SelectedItem="{Binding SelectedPurCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Established" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding Established}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Notes" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Notes}" 
                                                AcceptsReturn="True" 
                                                TextWrapping="Wrap"
                                                Height="80"
                                                Watermark="Enter notes (optional)"/>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- I&M - Transformers -->
                <TabItem Header="I&amp;M - Transformers">
                    <Grid ColumnDefinitions="2*,3*" Margin="10">
                        <!-- Left: ListBox-based table -->
                        <Border Grid.Column="0" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Margin="0,0,10,0" Background="#2d2d30">
                            <Grid RowDefinitions="Auto,Auto,*">
                                <!-- Record Count -->
                                <TextBlock Grid.Row="0" Text="{Binding Histories.Count, StringFormat='Records: {0}'}"
                                           Foreground="#999999"
                                           HorizontalAlignment="Right"
                                           Margin="0,5,10,5"/>
                                
                                <!-- Column Headers -->
                                <Border Grid.Row="1" Background="#3c3c3c" Padding="8">
                                    <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                        <TextBlock Grid.Column="0" Text="DevCode" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="1" Text="BegSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="2" Text="EndSer" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="3" Text="OOR" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="4" Text="Qty" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="5" Text="PONumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="6" Text="RecvDate" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="7" Text="CID" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="8" Text="MENumber" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                        <TextBlock Grid.Column="9" Text="Established" FontWeight="Bold" Foreground="#ffffff" FontSize="11"/>
                                    </Grid>
                                </Border>
                                
                                <!-- Data Rows -->
                                <ListBox Grid.Row="2"
                                         ItemsSource="{Binding Histories}"
                                         SelectedItem="{Binding SelectedHistory}"
                                         Background="Transparent"
                                         BorderThickness="0">
                                    <ListBox.Styles>
                                        <Style Selector="ListBoxItem">
                                            <Setter Property="Padding" Value="0"/>
                                            <Setter Property="Margin" Value="0"/>
                                            <Setter Property="Background" Value="#2d2d30"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:nth-child(even)">
                                            <Setter Property="Background" Value="#252526"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:selected">
                                            <Setter Property="Background" Value="#0078d4"/>
                                        </Style>
                                        <Style Selector="ListBoxItem:pointerover">
                                            <Setter Property="Background" Value="#3a3a3a"/>
                                        </Style>
                                    </ListBox.Styles>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border BorderBrush="#3f3f46" BorderThickness="0,0,0,1" Padding="8,6">
                                                <Grid ColumnDefinitions="80,80,80,100,50,80,80,60,80,80">
                                                    <TextBlock Grid.Column="0" Text="{Binding DevCode}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="1" Text="{Binding BegSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="2" Text="{Binding EndSer}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="3" Text="{Binding OOR}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Grid.Column="4" Text="{Binding Qty}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="5" Text="{Binding PONumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="6" Text="{Binding RecvDate, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="7" Text="{Binding CID}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="8" Text="{Binding MENumber}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                    <TextBlock Grid.Column="9" Text="{Binding Established, StringFormat='{}{0:MM/dd/yyyy}'}" Foreground="#e0e0e0" FontSize="11" VerticalAlignment="Center"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <Border Grid.Column="1" BorderBrush="#3f3f46" BorderThickness="1" CornerRadius="4" Padding="15" Background="#2d2d30">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="Record Details" FontSize="16" FontWeight="SemiBold" Foreground="#ffffff" Margin="0,0,0,10"/>

                                    <!-- Status Message -->
                                    <TextBlock Text="{Binding StatusMessage}"
                                               Foreground="#d13438"
                                               IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                               Margin="0,0,0,10"
                                               FontWeight="SemiBold"/>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Status" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Statuses}"
                                                 SelectedItem="{Binding SelectedStatus}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Manufacturer" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding Manufacturers}"
                                                 SelectedItem="{Binding SelectedManufacturer}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Device Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding DeviceCodes}"
                                                 SelectedItem="{Binding SelectedDevCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Beginning Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding BegSer}" Watermark="Enter beginning serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Ending Serial" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding EndSer}" Watermark="Enter ending serial"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Out of Range (OOR)" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Oor}" 
                                                Watermark="e.g., 10023-10033, 20023-20033"
                                                AcceptsReturn="False"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Quantity" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Qty}" IsReadOnly="True" Background="#252526"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding PoDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="PO Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding PoNumber}" Watermark="Enter PO number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Received Date" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding RecvDate}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Unit Cost" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding UnitCost}" Watermark="0.00"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="CID" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Cid}" Watermark="Enter CID"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="M.E. Number" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding MeNumber}" Watermark="Enter M.E. number"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Purchase Code" FontWeight="Medium" Foreground="#cccccc"/>
                                        <ComboBox ItemsSource="{Binding PurchaseCodes}"
                                                 SelectedItem="{Binding SelectedPurCode}"
                                                 DisplayMemberBinding="{Binding Code}"
                                                 HorizontalAlignment="Stretch"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Established" FontWeight="Medium" Foreground="#cccccc"/>
                                        <DatePicker SelectedDate="{Binding Established}"/>
                                    </StackPanel>

                                    <StackPanel Spacing="5">
                                        <TextBlock Text="Notes" FontWeight="Medium" Foreground="#cccccc"/>
                                        <TextBox Text="{Binding Notes}" 
                                                AcceptsReturn="True" 
                                                TextWrapping="Wrap"
                                                Height="80"
                                                Watermark="Enter notes (optional)"/>
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>

        <!-- Button Bar -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="10">
            <Button Content="Add New" Command="{Binding AddNewCommand}"/>
            <Button Content="Save" Command="{Binding SaveCommand}" Background="#107c10"/>
            <Button Content="Delete" Command="{Binding DeleteCommand}" Background="#d13438"/>
            <Button Content="Export CSV" Command="{Binding ExportCsvCommand}" Background="#505050"/>
        </StackPanel>
    </Grid>
    
</UserControl>
